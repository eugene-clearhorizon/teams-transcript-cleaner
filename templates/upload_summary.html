<!-- templates/upload_summary.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Summary 2:15</title>
</head>
<body>
    <h1>Upload Summary</h1>
    <p>{{ num_files }} files uploaded and processed.</p>

    <h2>File Information:</h2>
    <ul>
        {% for file_info in file_info_list %}
            <li>
                <strong>File Name:</strong> {{ file_info['filename'] }}<br>
                <br>
                <strong>Speakers:</strong> {{ file_info['names'] }}<br>
                <br>
                <!-- Add a download link for each file -->
                <a href="#" onclick="downloadAndDelete('{{ file_info['filename'] }}')">Download {{ file_info['filename'] }}</a>
                <br>
                <br>
            </li>
        {% endfor %}
    </ul>

    <script>
        function downloadAndDelete(filename) {
            // Create a temporary link element for initiating the download
            const link = document.createElement('a');
            link.href = `/cleaned_uploads/${filename}`;
            link.download = '';
            document.body.appendChild(link);

            // Simulate a click on the link to trigger the download
            link.click();

            // Remove the download attribute to prevent automatic download
            link.removeAttribute('download');

            // Remove the link after a short delay (adjust the delay as needed)
            setTimeout(() => {
                document.body.removeChild(link);

                // Make an asynchronous request to the server to delete the file
                fetch(`/delete_cleaned/${filename}`, {
                    method: 'POST',
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Failed to delete file: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data.message);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }, 1000); // 1000 milliseconds (adjust as needed)
        }
    </script>
</body>
</html>
